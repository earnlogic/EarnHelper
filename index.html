<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnHelper - Ultimate AI Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --neon-green: #2ecc71; --dark-bg: #121212; --card-bg: #1e1e1e; --text-gray: #b3b3b3; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark-bg); color: white; margin: 0; padding-bottom: 70px; }
        .container { padding: 15px; max-width: 500px; margin: auto; }
        .navbar { background: #000; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .card { background: var(--card-bg); border-radius: 15px; padding: 20px; margin-bottom: 15px; border: 1px solid #333; }
        
        /* Rank Badge Style */
        .rank-badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        .bronze { background: #cd7f32; } .silver { background: #c0c0c0; color: #333; } .gold { background: #ffd700; color: #333; }

        /* Floating AI Styles */
        #ai-btn { position: fixed; bottom: 85px; right: 20px; background: var(--neon-green); color: black; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4); z-index: 1001; }
        #ai-window { display: none; position: fixed; bottom: 145px; right: 20px; width: 300px; background: white; color: #333; border-radius: 15px; z-index: 1000; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ai-header { background: #1a1a1a; color: white; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; }
        
        /* Input Styles */
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; }
        .btn { background: var(--neon-green); color: black; border: none; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:hover { filter: brightness(1.2); }

        /* Withdraw Card Design */
        #success-card { display: none; background: linear-gradient(135deg, #000, #1e1e1e); border: 2px solid var(--neon-green); border-radius: 20px; padding: 25px; text-align: center; color: white; position: relative; margin-top: 15px; overflow: hidden; }
    </style>
</head>
<body>

<div class="navbar">
    <div style="font-weight: bold; font-size: 20px; color: var(--neon-green);">EarnHelper <span style="font-size: 10px; color: white;">PRO</span></div>
    <div id="userRankDisplay" class="rank-badge bronze">Bronze</div>
</div>

<div id="ai-btn" onclick="toggleAI()"><i class="fa fa-robot"></i></div>
<div id="ai-window">
    <div class="ai-header">ü§ñ Hybrid Assistant <span onclick="toggleAI()" style="cursor:pointer">&times;</span></div>
    <div style="padding: 15px;">
        <div id="ai-response" style="font-size: 13px; height: 100px; overflow-y: auto; background: #f4f4f4; padding: 8px; border-radius: 8px; margin-bottom: 10px;">‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã! ‡¶Ü‡¶ú ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?</div>
        <textarea id="ai-input" placeholder="‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." style="background: #eee; color: #333; height: 60px;"></textarea>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <button class="btn" style="font-size: 12px;" onclick="handleAI('chat')">Ask AI</button>
            <button class="btn" style="background:#3498db; font-size: 12px;" onclick="handleAI('free')">Free Tr.</button>
        </div>
    </div>
</div>

<div id="authSection" class="container">
    <div class="card">
        <h3 style="text-align: center;">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <input type="email" id="email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
        <input type="password" id="pass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
        
        <div id="registerFields" style="display: none;">
            <input type="text" id="username" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ">
            <select id="country">
                <option value="Bangladesh">Bangladesh</option>
                <option value="India">India</option>
                <option value="USA">USA</option>
                <option value="Other">Other</option>
            </select>
            <input type="text" id="refCode" placeholder="Refer Code (Optional)">
        </div>

        <button class="btn" id="mainBtn" onclick="handleLogin()">‡¶≤‡¶ó‡¶á‡¶®</button>
        <p onclick="toggleAuthMode()" id="toggleText" style="text-align:center; font-size:12px; cursor:pointer; color: var(--neon-green); margin-top:10px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</p>
    </div>
</div>

<div id="dashboard" class="container" style="display: none;">
    <div class="card" style="text-align: center; background: linear-gradient(135deg, #1a1a1a, #000);">
        <p style="color: var(--text-gray); margin: 0;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</p>
        <h1 id="coinDisplay" style="color: var(--neon-green); margin: 10px 0; font-size: 40px;">0</h1>
        <div style="font-size: 14px; color: #ffd700;" id="idDisplay">ID: EH-1000</div>
    </div>

    <div class="card">
        <h4><i class="fa fa-wallet"></i> ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</h4>
        <input type="number" id="withdrawAmt" placeholder="‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ü‡¶æ‡¶ï‡¶æ)">
        <button class="btn" onclick="generateCard()">‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        
        <div id="success-card">
            <p style="text-transform: uppercase; font-size: 12px; letter-spacing: 2px;">Payment Receipt</p>
            <h2 id="cardAmt" style="font-size: 35px; color: var(--neon-green);">‡ß≥ 0</h2>
            <p id="cardUser" style="margin: 5px 0; font-weight: bold;">User Name</p>
            <p id="cardCountry" style="font-size: 12px; opacity: 0.7;">Country</p>
        </div>
        
        <div id="cardControls" style="display: none; margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn" style="background: #34495e;" onclick="downloadCard()"><i class="fa fa-download"></i> ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div class="card">
        <h4><i class="fa fa-shield-halved"></i> ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ</h4>
        <button class="btn" style="background: #444;" onclick="changePassword()">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <button class="btn" style="background: #c0392b; margin-top: 10px;" onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
</div>

<script>
    // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï Supabase Config
    const sURL = 'https://xserxssnjdshehrefhvr.supabase.co';
    const sKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzZXJ4c3NuamRzaGVocmVmaHZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MzY4MTgsImV4cCI6MjA4NzQxMjgxOH0.Dow2NjohUNLgpDluVKcV4TBACCpDyCa31BH-tdLYik8';
    const supabaseClient = supabase.createClient(sURL, sKey);
    
    // AI API Keys (Rotation)
    const geminiKeys = ["AIzaSyBduk7N7im9_Lm2FqRCsyPdS6ZHL665wY4", "AIzaSyDvpWR6XnLN1zlOpm-EA4N9DO34U6nmxn8"];
    let gIdx = 0;
    let isLoginMode = true;

    async function handleLogin() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        if(isLoginMode) {
            const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password: pass });
            if(error) alert(error.message); else location.reload();
        } else {
            const user = document.getElementById('username').value;
            const country = document.getElementById('country').value;
            const { data, error } = await supabaseClient.auth.signUp({ email, password: pass });
            if(error) return alert(error.message);
            await supabaseClient.from('profiles').insert([{ id: data.user.id, username: user, country: country }]);
            alert("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }
    }

    function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        document.getElementById('registerFields').style.display = isLoginMode ? 'none' : 'block';
        document.getElementById('mainBtn').innerText = isLoginMode ? '‡¶≤‡¶ó‡¶á‡¶®' : '‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®';
        document.getElementById('toggleText').innerText = isLoginMode ? '‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®' : '‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®';
    }

    window.onload = async () => {
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (session) {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            loadData(session.user.id);
        }
    };

    async function loadData(uid) {
        const { data } = await supabaseClient.from('profiles').select('*').eq('id', uid).single();
        if(data) {
            document.getElementById('coinDisplay').innerText = data.coins || 0;
            document.getElementById('idDisplay').innerText = "ID: EH-" + data.id.substring(0,4);
            updateRank(data.coins || 0);
            window.userData = data;
        }
    }

    function updateRank(coins) {
        let r = "Bronze", c = "bronze";
        if(coins > 5000) { r = "Silver"; c = "silver"; }
        if(coins > 20000) { r = "Gold"; c = "gold"; }
        const b = document.getElementById('userRankDisplay');
        b.innerText = r; b.className = "rank-badge " + c;
    }

    function toggleAI() { let w = document.getElementById('ai-window'); w.style.display = w.style.display==='block'?'none':'block'; }

    async function handleAI(mode) {
        const box = document.getElementById('ai-response');
        const input = document.getElementById('ai-input').value;
        if(!input) return alert("‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");
        box.innerText = "‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
        const key = geminiKeys[gIdx % geminiKeys.length]; gIdx++;
        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                method: "POST", headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ contents: [{ parts: [{ text: input }] }] })
            });
            const d = await res.json();
            box.innerText = d.candidates[0].content.parts[0].text;
        } catch(e) { box.innerText = "Error! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"; }
    }

    function generateCard() {
        document.getElementById('cardAmt').innerText = "‡ß≥ " + document.getElementById('withdrawAmt').value;
        document.getElementById('cardUser').innerText = window.userData.username;
        document.getElementById('cardCountry').innerText = window.userData.country;
        document.getElementById('success-card').style.display = 'block';
        document.getElementById('cardControls').style.display = 'grid';
    }

    function downloadCard() {
        html2canvas(document.querySelector("#success-card")).then(canvas => {
            let link = document.createElement('a');
            link.download = 'EarnHelper.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    async function logout() { await supabaseClient.auth.signOut(); location.reload(); }
</script>
</body>
</html>
